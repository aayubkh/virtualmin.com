<script>
    (function () {
        // Define authentication state
        const menu = document.querySelector('#menu'),
            supportItem = document.querySelector('.menu-item--support'),
            signInItem = document.querySelector('.menu-item--singin'),
            userItem = document.querySelector('.menu-item--user'),
            avatar_url = localStorage.getItem("virtualmin-menu-item--user--url");
        if (avatar_url && avatar_url.toString().startsWith('http')) {
            const userAvatar = userItem.querySelector('a > img');
            userAvatar.src = avatar_url;
            userItem.classList.remove('hidden');
            menu.classList.add('menu-authenticated');
            document.documentElement.setAttribute('data-auth', 1);
        } else {
            signInItem.classList.remove('hidden');
            menu.classList.add('menu-unauthenticated');
            document.documentElement.setAttribute('data-auth', 0);
        }
        // https://cdn.forum.virtualmin.com/user_avatar/forum.virtualmin.com/ilia/144/10185_2.png
        if (signInItem && signInItem.classList.contains('hidden')) {
            supportItem.classList.remove('hidden');
        }
    })();
</script>
{{ if eq .RelPermalink "/" }}
<script>
    (function () {
        // Sticky header magic
        const header_sticky_class_str = "header-sticky";
        window.addEventListener(
            "scroll",
            function () {
                this.currentScroll = window.scrollY || document.documentElement.scrollTop;
                this.lastScroll = 2; //up
                if (this.currentScroll < this.lastScrollTop) {
                    this.lastScroll = 1; // down
                }
                this.lastScrollTop = this.currentScroll <= 0 ? 0 : this.currentScroll;
                const header = document.querySelector(".page-index > body > header"),
                    headerBounds = header.getBoundingClientRect(),
                    headerHeight = headerBounds.height;
                if (
                    this.lastScroll === 2 &&
                    headerBounds.top <= 0 &&
                    !header.classList.contains(header_sticky_class_str)
                ) {
                    header.classList.add(header_sticky_class_str);
                    window.scrollBy(window.scrollY, +headerHeight);
                    window.dispatchEvent(new Event("resize")); // reposition dropdown
                } else if (
                    this.lastScroll === 1 &&
                    window.innerHeight - window.scrollY >= 0 &&
                    header.classList.contains(header_sticky_class_str)
                ) {
                    header.classList.remove(header_sticky_class_str);
                    window.scrollBy(window.scrollY, -headerHeight);
                    window.dispatchEvent(new Event("resize")); // reposition dropdown
                }
            },
            false
        );
        // Trigger scroll event on initial load
        window.dispatchEvent(new Event("scroll"));

        function setVhVariable() {
            let vh = window.innerHeight * 0.01;
            document.documentElement.style.setProperty('--vh', `${vh}px`);
            alert(vh);
        }
        window.addEventListener('resize', setVhVariable);
        setVhVariable();
    })();
</script>
{{ end }}